<div class="main-container">
  <div class="x_panel">
    <div class="x_header">
      <div class="d-flex justify-content-between">
        <div class="col-8">
          <div class="px-1">
            <app-breadcrums [title]="'Appraisal Cycle'"></app-breadcrums>
          </div>
        </div>
        <div class="col-4 text-end">
          <button class="btn btn-primary-c" (click)="addAprisalCyclePopUp()"><i class="fa fa-plus pe-1"></i> Add Aprisal Cycle</button>
        </div>
      </div>
    </div>
    <div [ngSwitch]="isPageReady">
      <div *ngSwitchCase="false">
        <div class="mt-5">
          <app-pre-load-table></app-pre-load-table>
        </div>
      </div>
      <div *ngSwitchDefault>
        <ng-container>
          <div class="x_content">
            <div class="t-table t-list t-border col-md-12">
              <div class="hide-bar"></div>
              <div class="t-head">
                <div class="tr">
                  <div class="th fe-index">
                    <div class="t-filter t-index">
                      <a href="javascript:void()" class="ps-3">#</a>
                    </div>
                  </div>
                  <div class="th fe-2">
                    <div class="cell-wrapper">
                      <input class="form-control form-control-sm" (keydown.esc)="resetFilter()"
                        (keyup.enter)="filterRecords()" [(ngModel)]="apprisalDetail.ApprisalName"
                        placeholder="Search by Apprisal Name">
                      <div class="t-filter" (click)="arrangeDetails(orderByApprisalNameAsc, 'ApprisalName')">
                        <a href="javascript:void()" class="pe-2">Appraisal Name</a>
                        <i class="fa fa-sort-amount-asc"
                          [ngClass]="{'d-none': orderByApprisalNameAsc == null || !orderByApprisalNameAsc }" aria-hidden="true"></i>
                        <i class="fa fa-sort-amount-desc"
                          [ngClass]="{'d-none': orderByApprisalNameAsc == null || orderByApprisalNameAsc }" aria-hidden="true"></i>
                      </div>
                    </div>
                  </div>
                  <div class="th fe-2">
                    <div class="cell-wrapper">
                      <input class="form-control form-control-sm" (keydown.esc)="resetFilter()"
                      (keyup.enter)="filterRecords()" [(ngModel)]="apprisalDetail.ApprisalCyclePeriod"
                        placeholder="Search by Apprisal Cycle Period">
                      <div class="t-filter" (click)="arrangeDetails(orderByCyclePeriodAsc, 'ApprisalCyclePeriod')">
                        <a href="javascript:void()" class="pe-2">Appraisal Cycle Period</a>
                        <i class="fa fa-sort-amount-asc"
                        [ngClass]="{'d-none': orderByCyclePeriodAsc == null || !orderByCyclePeriodAsc }" aria-hidden="true"></i>
                      <i class="fa fa-sort-amount-desc"
                        [ngClass]="{'d-none': orderByCyclePeriodAsc == null || orderByCyclePeriodAsc }" aria-hidden="true"></i>
                      </div>
                    </div>
                  </div>
                  <div class="th fe-4">
                    <div class="cell-wrapper">
                      <input class="form-control form-control-sm" placeholder="Search by Description"
                      (keydown.esc)="resetFilter()" (keyup.enter)="filterRecords()" [(ngModel)]="apprisalDetail.Description">
                      <div class="t-filter" (click)="arrangeDetails(orderByDescriptionAsc, 'Description')">
                        <a href="javascript:void()" class="pe-2">Description</a>
                        <i class="fa fa-sort-amount-asc"
                          [ngClass]="{'d-none': orderByDescriptionAsc == null || !orderByDescriptionAsc }" aria-hidden="true"></i>
                        <i class="fa fa-sort-amount-desc"
                          [ngClass]="{'d-none': orderByDescriptionAsc == null || orderByDescriptionAsc }" aria-hidden="true"></i>
                      </div>
                    </div>
                  </div>
                  <div class="th fe-1 text-center">
                    <a href="javascript:void(0)" class="a-btn text-success ps-1 fw-bold" (click)="filterRecords()">
                      <i class="fa fa-filter">
                        <span>Filter</span>
                      </i>
                    </a>
                    <div class="t-filter d-block text-center">
                      <a href="javascript:void(0)">ACTIONS</a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="t-body">
                <ng-container *ngIf="apprisalCycleDetail.length > 0">
                  <div class="tr py-2" *ngFor="let item of apprisalCycleDetail; let i=index;">
                    <div class="td align-middle text-center fe-index">{{i+1}}</div>
                    <div class="td align-middle fe-2 text-truncate">
                      {{item.ApprisalName}}
                    </div>
                    <div class="td align-middle fe-2">
                      <div class="cell-wrapper">
                        {{item.ApprisalCyclePeriod | date}}
                      </div>
                    </div>
                    <div class="td align-middle text-truncate fe-4">
                      <div class="cell-wrapper text-truncate">
                        {{item.Description | date}}
                      </div>
                    </div>
                    <div class="td align-middle text-center fe-1">
                      <a href="javascript:void(0)" (click)="editApprisalPopUp(item)" data-bs-toggle="tooltip" data-bs-placement="right" title="Edit Apprisal">
                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                      </a>
                      <a href="javascript:void(0)" class="ms-2" data-bs-toggle="tooltip" data-bs-placement="right" title="Delete Apprisal">
                        <i class="fa fa-trash-o text-danger" aria-hidden="true"></i>
                      </a>
                    </div>
                  </div>
                </ng-container>
              </div>
              <ng-container *ngIf="apprisalCycleDetail.length == 0">
                <div class="custom-height my-5 py-5 fw-bold fs-3 text-danger d-flex align-items-center justify-content-center">
                  <p class="my-5 py-5">Record Not Found</p>
                </div>
              </ng-container>
            </div>
          </div>
          <div class="mt-3" *ngIf="isPageReady">
            <app-pagination [pagination]="apprisalData" (onPageChange)="GetFilterResult($event)"></app-pagination>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>


<!-- Add or update apprisal Modal -->
<div class="modal addclinet-modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="manageApprisal" aria-labelledby="manageApprisalModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content px-3">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title" id="manageApprisalModalLabel">Add/Update Apprisal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="appraisalForm">
          <div>
            <label for="" class="form-label">Name of the Apprisal</label>
            <input type="text" class="form-control" placeholder="Apprisal Name" formControlName="ApprisalName"
            [ngClass]="{'error-field': isSubmitted && f.ApprisalName.errors !== null && f.ApprisalName.errors.required}">
          </div>
          <div class="mt-3">
            <label for="" class="form-label">Apprisal Cycle Period</label>
            <form class="row row-cols-sm-auto">
              <div class="col-12">
                <div class="dp-hidden position-absolute">
                  <div class="input-group">
                    <input
                      name="datepicker"
                      class="form-control"
                      ngbDatepicker
                      #datepicker="ngbDatepicker"
                      [autoClose]="'outside'"
                      (dateSelect)="onDateSelection($event)"
                      [displayMonths]="2"
                      [dayTemplate]="t"
                      outsideDays="hidden"
                      [startDate]="fromDate!"
                      tabindex="-1"
                    />
                    <ng-template #t let-date let-focused="focused">
                      <span
                        class="custom-day"
                        [class.focused]="focused"
                        [class.range]="isRange(date)"
                        [class.faded]="isHovered(date) || isInside(date)"
                        (mouseenter)="hoveredDate = date"
                        (mouseleave)="hoveredDate = null"
                      >
                        {{ date.day }}
                      </span>
                    </ng-template>
                  </div>
                </div>
                <div class="input-group">
                  <input
                    #dpFromDate
                    class="form-control"
                    placeholder="yyyy-mm-dd"
                    name="dpFromDate"
                    [value]="formatter.format(fromDate)"
                    (input)="fromDate = validateInput(fromDate, dpFromDate.value)"
                  />
                  <button class="btn btn-outline-secondary bi bi-calendar3" (click)="datepicker.toggle()" type="button"></button>
                </div>
              </div>
              <div class="col-12">
                <div class="input-group">
                  <input
                    #dpToDate
                    class="form-control"
                    placeholder="yyyy-mm-dd"
                    name="dpToDate"
                    [value]="formatter.format(toDate)"
                    (input)="toDate = validateInput(toDate, dpToDate.value)"
                  />
                  <button class="btn btn-outline-secondary bi bi-calendar3" (click)="datepicker.toggle()" type="button"></button>
                </div>
              </div>
            </form>
            <input type="text" class="form-control" placeholder="Apprisal Cycle Period" formControlName="ApprisalCyclePeriod"
            [ngClass]="{'error-field': isSubmitted && f.ApprisalCyclePeriod.errors !== null && f.ApprisalCyclePeriod.errors.required}">
          </div>
          <div class="mt-3">
            <label for="" class="form-label">Description</label>
            <textarea rows="3" class="form-control" placeholder="Description" formControlName="Description"
            [ngClass]="{'error-field': isSubmitted && f.Description.errors !== null && f.Description.errors.required}"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button class="btn btn-primary-c" (click)="addApprisalCycle()">
          <i class="fa" [ngClass]="{'fa-spin fa-spinner': isLoading, 'fa-plus-square-o': !isLoading}"></i>
          <span class="ps-2">
           {{currentApprisalCycle.ApprisalCycleId == 0 ? 'Add' : 'Update'}} Apprisal
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Close Modal -->
