<div class="col-md-12 main-container" [ngClass]="{'preload': !isEmpPageReady}">
  <div class="x_panel">
    <div class="x_header">
      <div class="x_header_title row">
        <div class="col-md-3">
          <h2>Employees<small>bill details</small></h2>
        </div>
      </div>
    </div>
    <div class="px-1">
      <app-breadcrums></app-breadcrums>
    </div>
    <ng-container>
      <div class="x_header">
        <div class="x_header_title mt-3">
          <div class="d-flex justify-content-between">
            <div class="row col-md-7">
              <div class="d-flex col-md-5" *ngIf="fileLoaded">
                <label class="form-label pe-3 mt-1">Developer</label>
                <div class="col-md-9">
                  <app-iautocomplete [data]="autoCompleteModal" [(ngModel)]="employeeId"
                    (OnSelect)="onEmloyeeChanged($event)" (keydown.esc)="resetFilter()">
                  </app-iautocomplete>
                </div>
              </div>
              <div class="col-md-4 d-flex">
                <div class="th f-small">
                  <div class="cell-wrapper">
                    <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                      (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.Month">
                      <option value="0" selected>Month</option>
                      <option value="1">Jan</option>
                      <option value="2">Feb</option>
                      <option value="3">Mar</option>
                      <option value="4">Apr</option>
                      <option value="5">May</option>
                      <option value="6">June</option>
                      <option value="7">July</option>
                      <option value="8">Aug</option>
                      <option value="9">Sep</option>
                      <option value="10">Oct</option>
                      <option value="11">Nov</option>
                      <option value="12">Dec</option>
                    </select>
                  </div>
                </div>
                <div class="th f-small">
                  <div class="cell-wrapper">
                    <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                      (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.Year">
                      <option value="0" selected>Year</option>
                      <option [value]="item" *ngFor="let item of allBillingYears">{{item}}</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <a href="javascript:void(0)" class="pe-0 a-btn text-dark fw-bold" (click)="advancedSearchPopUp()">
                  <i class="fa fa-search">
                    <span>Advanced Search</span>
                  </i>
                </a>
              </div>
            </div>
            <div class="d-flex flex-row align-items-center">
              <div class="text-end">
                <a href="javascript:void(0)" class="a-btn text-danger fw-bold" (click)="refreshFilter()">
                  <i class="fa fa-refresh">
                    <span>Reset</span>
                  </i>
                </a>
              </div>
              <div class="text-end">
                <a href="javascript:void(0)" class="a-btn text-success ps-1 fw-bold" (click)="filterRecords()">
                  <i class="fa fa-filter">
                    <span>Filter</span>
                  </i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pdf viewer modal -->
      <div class="d-none file-container" id="file-container" (click)="closePdfViewer()">
        <div class="text-end">
          <a (click)="closePdfViewer()" class="close_view">
            <i class="fa fa-times fa-2x" aria-hidden="true"></i>
          </a>
        </div>
        <iframe src="" width="800px" height="600px" style="border: none;"></iframe>
      </div>
      <!-- End pdf view modal -->
      <div class="x_content">
        <div class="t-table t-list t-border col-md-12">
          <div class="hide-bar"></div>
          <div class="t-head">
            <div class="tr">
              <div class="th fe-2">
                <div class="cell-wrapper">
                  <input class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                    (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.BillNo" placeholder="Bill No#">
                  <div class="t-filter" (click)="arrangeDetails(orderByBillNoAsc, 'BillNo')">
                    <a href="javascript:void()" class="pe-2">Bill No.#</a>
                    <i class="fa fa-sort-amount-asc"
                      [ngClass]="{'d-none': orderByBillNoAsc == null || !orderByBillNoAsc }" aria-hidden="true"></i>
                    <i class="fa fa-sort-amount-desc"
                      [ngClass]="{'d-none': orderByBillNoAsc == null || orderByBillNoAsc }" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
              <div class="th fe-3">
                <div class="cell-wrapper">
                  <input class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                    (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.ClientName" placeholder="By Client Name">
                  <div class="t-filter" (click)="arrangeDetails(orderByNameAsc, 'ClientName')">
                    <a href="javascript:void()" class="pe-2">Client Name</a>
                    <i class="fa fa-sort-amount-asc" [ngClass]="{'d-none': orderByNameAsc == null || !orderByNameAsc }"
                      aria-hidden="true"></i>
                    <i class="fa fa-sort-amount-desc" [ngClass]="{'d-none': orderByNameAsc == null || orderByNameAsc }"
                      aria-hidden="true"></i>
                  </div>
                </div>
              </div>
              <div class="th f-small">
                <div class="cell-wrapper">
                  <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                    (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.Status">
                    <option value="0">Status</option>
                    <option value="1">Completed</option>
                    <option value="2">Pending</option>
                    <option value="3">Canceled</option>
                    <option value="7">Raised</option>
                  </select>
                  <div class="t-filter align-items-center justify-content-center">
                    <a href="javascript:void()" class="pe-2">IsPaid</a>
                  </div>
                </div>
              </div>
              <div class="th fe-1">
                <div class="cell-wrapper">
                  <div class="t-filter">
                    <a href="javascript:void()" class="pe-2">Paid On</a>
                  </div>
                </div>
              </div>
              <div class="th f-small">
                <div class="cell-wrapper">
                  <!-- <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                    (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.Month">
                    <option value="0" selected>Month</option>
                    <option value="1">Jan</option>
                    <option value="2">Feb</option>
                    <option value="3">Mar</option>
                    <option value="4">Apr</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">Aug</option>
                    <option value="9">Sep</option>
                    <option value="10">Oct</option>
                    <option value="11">Nov</option>
                    <option value="12">Dec</option>
                  </select> -->
                  <div class="t-filter" (click)="arrangeDetails(orderByMonthAsc, 'BillForMonth')">
                    <a href="javascript:void()" class="pe-2">Month</a>
                    <i class="fa fa-sort-amount-asc"
                      [ngClass]="{'d-none': orderByMonthAsc == null || !orderByMonthAsc }" aria-hidden="true"></i>
                    <i class="fa fa-sort-amount-desc"
                      [ngClass]="{'d-none': orderByMonthAsc == null || orderByMonthAsc }" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
              <!-- <div class="th f-small">
                <div class="cell-wrapper">
                  <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                    (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.Year">
                    <option value="0" selected>Year</option>
                    <option [value]="item" *ngFor="let item of allBillingYears">{{item}}</option>
                  </select>
                  <div class="t-filter" (click)="arrangeDetails(orderByYearAsc, 'BillYear')">
                    <a href="javascript:void()" class="pe-2">Year</a>
                    <i class="fa fa-sort-amount-asc"
                      [ngClass]="{'d-none': orderByYearAsc == null || !orderByYearAsc }" aria-hidden="true"></i>
                    <i class="fa fa-sort-amount-desc"
                      [ngClass]="{'d-none': orderByYearAsc == null || orderByYearAsc }" aria-hidden="true"></i>
                  </div>
                </div>
              </div> -->
              <div class="th fe-1">
                <div class="cell-wrapper">
                  <input class="form-control table-filter-control form-control-sm" readonly
                    (keyup.enter)="filterRecords()" (keydown.esc)="refreshFilter()"
                    [(ngModel)]="employeeFile.BilledAmount" placeholder="By Billed Amount">
                  <div class="t-filter">
                    <a href="javascript:void()" class="ps-2">Billed Amt</a>
                  </div>
                </div>
              </div>
              <div class="th fe-1">
                <div class="cell-wrapper">
                  <input class="form-control table-filter-control form-control-sm" readonly
                    (keyup.enter)="filterRecords()" (keydown.esc)="refreshFilter()"
                    [(ngModel)]="employeeFile.ReceivedAmount" placeholder="By Received Amount">
                  <div class="t-filter">
                    <a href="javascript:void()" class="pe-2">Received</a>
                  </div>
                </div>
              </div>
              <div class="th fe-1">
                <div class="cell-wrapper">
                  <input class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                    readonly (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.TakeHome"
                    placeholder="By Take Home">
                  <div class="t-filter">
                    <a href="javascript:void()" class="pe-2">Take Home</a>
                  </div>
                </div>
              </div>
              <div class="th f-small">
                <div class="cell-wrapper">
                  <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                    (keydown.esc)="refreshFilter()" [(ngModel)]="employeeFile.GSTStatus">
                    <option value="0">Status</option>
                    <option value="1">Completed</option>
                    <option value="2">Pending</option>
                    <option value="3">Canceled</option>
                    <option value="6">Raised</option>
                  </select>
                  <div class="t-filter justify-content-center align-items-center">
                    <a href="javascript:void()" class="pe-2">GST</a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div [ngSwitch]="isEmpPageReady">
            <div class="p-4" *ngSwitchCase="false">
              <app-pre-load-table></app-pre-load-table>
            </div>
            <div *ngSwitchDefault>
              <div class="t-body custom-height">
                <ng-container *ngIf="isFileFound">
                  <div class="tr py-2" *ngFor="let user of billDetails">
                    <div class="td align-middle fe-2">
                      <div class="cell-wrapper">
                        <div class="d-flex flex-row justify-content-between">
                          <a href="javascript:void(0)" class="bold-anc" (click)="EditCurrentDocument(user)">{{user.BillNo}}</a>
                          <div class="d-flex flex-row justify-content-around">
                            <a href="javascript:void(0)">
                              <span class="badge bg-success ms-1 me-1"><i class="fa fa-file-pdf-o" aria-hidden="true"
                                  (click)="viewPdfFile(user)"></i></span>
                            </a>
                            <a href="javascript:void(0)">
                              <span class="badge bg-primary ms-1 me-1"><i class="fa fa-download" aria-hidden="true"
                                  (click)="downloadFile(user)"></i></span>
                            </a>
                            <a href="javascript:void(0)">
                              <span class="badge bg-danger ms-1 me-1"><i class="fa fa-send" aria-hidden="true"
                                  (click)="getEmailTemplate(user)"></i></span>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="td align-middle fe-3">
                      <div class="cell-wrapper">
                        <div>
                          <a href="javascript:void(0)" class="clientName-text"
                            [ngClass]="{'blinking': user.Status == 'Raised', 'text-plain': user.Status != 'Raised'}"
                            (click)="EditClient(user.ClientId)">{{user.ClientName}}</a>
                          <div class="float-end">
                            <a><span class="badge bg-primary">T {{user.NoOfDays}}</span></a>
                            <span class="badge bg-danger ms-3">A {{user.Absent}}</span>
                          </div>
                        </div>
                        <small class="text-muted"><a href="javascript:void(0)" class="text-muted"
                            (click)="EditEmployee(user.FileOwnerId)">{{user.Name}}</a>
                        </small>
                      </div>
                    </div>
                    <div class="td align-middle f-small">
                      <div class="cell-wrapper text-center">
                        <a href="javascript:void(0)" class="h-font" (click)="UpdateCurrent(user)">
                          <i class="fa fa-check fa-lg text-success" *ngIf="user.Status == '1'" data-bs-trigger="hover"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Completed"></i>
                          <i class="fa fa-times text-danger fa-lg" *ngIf="user.Status == '3'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Canceled"></i>
                          <i class="fa fa-clock-o text-dark" *ngIf="user.Status == '7'" data-bs-toggle="tooltip"
                            data-bs-placement="right" title="Raised"></i>
                          <i class="fa fa-exclamation-triangle fa-lg text-warning" *ngIf="user.Status == '2'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Pending"></i>
                          <i class="fa fa-ban fa-lg text-danger" *ngIf="user.Status == '5'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Rejected"></i>
                          <!-- <i class="fa" [ngClass]="{'fa-check fa-lg text-success': user.Status == 'Completed', 'fa-times text-danger fa-lg': user.Status == 'Canceled', 'fa-clock-o text-dark': user.Status == 'Raised', 'fa-exclamation-triangle fa-lg text-warning': user.Status == 'Pending', 'fa-ban fa-lg text-danger': user.Status == 'Rejected'}"></i> -->
                          <!-- {{user.Status}} -->
                        </a>
                      </div>
                    </div>
                    <div class="td align-middle fe-1">
                      <div class="cell-wrapper">
                        {{user.PaidOn | date}}
                      </div>
                    </div>
                    <div class="td align-middle f-small">
                      <div class="cell-wrapper">
                        {{user.Month | slice: 0:3}}, {{user.Year}}
                      </div>
                    </div>
                    <div class="td align-middle fe-1">
                      <div class="cell-wrapper">
                        <div>
                          <b>{{user.BilledAmount | number : '1.2-2'}}</b>
                          <div class="d-flex flex-column">
                            <small class="s-item text-muted">[A] {{user.SalaryAmount | number : '1.2-2'}}</small>
                            <small class="s-item text-muted">[G] {{user.GSTAmount | number : '1.2-2'}}</small>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="td align-middle fe-1">
                      <div class="cell-wrapper">
                        <b>{{user.ReceivedAmount | number : '1.2-2'}}</b>
                        <div>
                          <small class="text-muted">[- 10% TDS]</small>
                        </div>
                      </div>
                    </div>
                    <div class="td align-middle fe-1">
                      <div class="cell-wrapper">
                        {{user.TakeHome | number : '1.2-2'}}
                      </div>
                    </div>
                    <div class="td align-middle f-small">
                      <div class="cell-wrapper text-center">
                        <a href="javascript:void(0)" class="h-font"
                          (click)="updateGSTStatus(user)">
                          <i class="fa fa-check fa-lg text-success" *ngIf="user.GSTStatus == '1'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Completed"></i>
                          <i class="fa fa-times text-danger fa-lg" *ngIf="user.GSTStatus == '3'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Canceled"></i>
                          <i class="fa fa-clock-o text-dark" *ngIf="user.GSTStatus == '7'" data-bs-toggle="tooltip"
                            data-bs-placement="right" title="Raised"></i>
                          <i class="fa fa-exclamation-triangle fa-lg text-warning" *ngIf="user.GSTStatus == '2'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Pending"></i>
                          <i class="fa fa-ban fa-lg text-danger" *ngIf="user.GSTStatus == '5'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Rejected"></i>
                          <i class="fa fa-lg fa-calendar-times-o text-primary" *ngIf="user.GSTStatus == '6'"
                            data-bs-toggle="tooltip" data-bs-placement="right" title="Generated"></i>
                          <!-- {{user.GSTStatus}} -->
                        </a>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngIf="!isFileFound">
                  <div class="custom-height fw-bold fs-3 text-danger d-flex align-items-center justify-content-center">
                    Record Not Found
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>

        <ng-container *ngIf="isFileFound">
          <div class="t-table t-list t-border col-md-12">
            <div class="hide-bar"></div>
            <div class="t-head">
              <div class="tr">
                <div class="th fe-1 justify-content-start align-items-start">
                  <button class="btn btn-success btn-sm ms-2" (click)="calculation()">&#8377; &nbsp; Amount</button>
                </div>
                <div class="th fe-2"></div>
                <div class="th fe-1"></div>
                <div class="th fe-1"></div>
                <div class="th fe-1"></div>
                <div class="th fe-1 justify-content-center align-items-start">
                  <div class="fw-bold d-flex flex-column ps-2" *ngIf="calculateAmount">
                    Rs {{TotalBilledAmount | number : '1.2-2'}}
                    <div>
                      <small class="s-item text-muted me-2 d-block">[A] {{ TotalSalaryAmount | number :
                        '1.2-2'}}</small>
                      <small class="s-item text-muted">[G] {{TotalGSTAmount | number : '1.2-2'}}</small>
                    </div>
                  </div>
                </div>
                <div class="th fe-1  justify-content-start">
                  <span class="fw-bold text-dark ps-2" *ngIf="calculateAmount">Rs {{TotalReceivedAmount | number :
                    '1.2-2'}}</span>
                </div>
                <div class="th fe-1">
                </div>
                <div class="th fe-1">
                </div>
              </div>
            </div>
          </div>
        </ng-container>

      </div>
      <div class="mt-3 ps-2" *ngIf="isEmpPageReady">
        <app-pagination [pagination]="singleEmployee" (onPageChange)="GetFilterResult($event)"></app-pagination>
      </div>
    </ng-container>
  </div>
</div>


<!-- add update GST detail modal -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="gstupdateModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title">Add or Update GST Status</h5>
      </div>
      <div class="modal-body f-12">
        <div class="col-md-12">
          <div [formGroup]="gstDetailForm" class="col-md-12 popup-form">
            <div class="col-md-12 row m-0">
              <div class="col-4 form-group">
                <label class="form-label">Bill No.#</label>
                <input class="form-control disabled text-muted" disabled formControlName="Billno">
              </div>
              <div class="col-4 form-group">
                <label class="form-label">GST Status</label>
                <select formControlName="Gststatus" name="Gststatus" class="form-select">
                  <option value="0">Status Type</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="4">Not Generated</option>
                  <option value="5">Rejected</option>
                  <option value="6">Generated</option>
                </select>
              </div>
              <div class="col-4 form-group">
                <label class="form-label">Paid On</label>
                <form class="form-inline">
                  <div class="form-group w-100">
                    <div class="input-group w-100">
                      <input class="form-control" placeholder="yyyy-mm-dd" name="dp" [(ngModel)]="model"
                        (dateSelect)="onDateSelection($event)" ngbDatepicker #d="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button"><i
                            class="fa fa-calendar" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="col-md-12 row m-0 mt-4">
              <div class="col-4 form-group">
                <label class="form-label">GST Amount</label>
                <input class="form-control disabled text-muted" disabled placeholder="GST Amount"
                  formControlName="Amount">
              </div>
              <div class="col-4 form-group">
                <label class="form-label">Paid By</label>
                <select formControlName="Paidby" name="Paidby" class="form-select" disabled>
                  <option value="0">Employee Name</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="4">Not Generated</option>
                  <option value="5">Rejected</option>
                </select>
              </div>
            </div>
            <div class="col-md-12 row m-0">
              <div class="form-group mt-4">
                <input type="file" id="uploadocument" class="d-none" multiple (change)="GetDocumentFile($event)" />
                <a href="javascript:void(0)" class="text-muted d-inline-block mt-4 mb-2 pe-none">
                  <i class="fa fa-upload zoom-2"></i>
                </a>
                <span class="ps-2">click to upload documents</span>
                <span class="ps-3">This function is under construction.....</span>
              </div>
            </div>
          </div>
          <p class="ps-3 mb-0 text-danger fw-bold" *ngIf="isError">GST Status is manditory</p>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-secondary" (click)="closeWindow()">Close</button>
        <button class="btn btn-primary-c" [disabled]="isLoading" (click)="submitGSTStatusDetail()">
          <i class="fa pe-2" [ngClass]="{'fa-spin fa-spinner': isLoading, 'fa-floppy-o': !isLoading}"></i>
          {{ isLoading ? 'Processing' : 'Submit' }}
        </button>
      </div>
    </div>
  </div>
</div>


<!-- add update Bill Status Details detail modal -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="addupdateModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title ps-2">Bill Status Update Modal</h5>
      </div>
      <h6 class="ps-4">Please update Bill paidon status.</h6>
      <div class="modal-body f-12">
        <div class="col-md-12">
          <div [formGroup]="documentForm" class="col-md-12 popup-form">
            <div class="col-md-12 row m-0">
              <div class="col-6 form-group">
                <label for="" class="form-label">File Status</label>
                <select formControlName="StatusId" name="StatusId" class="form-select">
                  <option value="0">File Status Type</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <!-- <option value="4">Not Generated</option> -->
                  <option value="5">Rejected</option>
                  <option value="7">Bill Raised</option>
                </select>
              </div>
              <div class="col-6 form-group">
                <label for="" class="form-label">Updated On</label>
                <form class="form-inline">
                  <div class="form-group w-100">
                    <div class="input-group w-100">
                      <input class="form-control" placeholder="yyyy-mm-dd" name="dp" [(ngModel)]="model"
                        (dateSelect)="onDateSelection($event)" ngbDatepicker #billd="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary calendar" (click)="billd.toggle()" type="button"><i
                            class="fa fa-calendar" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="col-md-12 row m-0">
              <div class="form-group mt-4">
                <label for="">Notes</label>
                <textarea name="Notes" rows="3" formControlName="Notes" class="form-control"></textarea>
              </div>
            </div>
            <p *ngIf="isError fw-bold" class="ps-3 text-danger fw-bold pb-0 pt-3">File Status is manditory</p>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-secondary" (click)="closeWindow()">Close</button>
        <button class="btn btn-primary-c" [disabled]="isLoading" (click)="updateRecord()">
          <i class="fa" [ngClass]="{'fa-spin fa-spinner': isLoading, 'fa-floppy-o': !isLoading}"></i>
          {{ isLoading ? 'Processing' : 'Submit' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Advanced Search model -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="advancedSearchModal" tabindex="-1"
  aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header border-bottom-0 ps-5 pt-4">
        <h5 class="modal-title" id="exampleModalLabel">Advanced Filter</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <p class="ps-5">In advanced search you will serach everything</p>
      <div class="modal-body ps-5 pe-4 pt-3 pb-4">
        <div class="col-md-12 row">
          <div class="col-md-3" *ngIf="fileLoaded">
            <label class="form-label pe-3">Employee</label>
            <div>
              <app-iautocomplete [data]="autoCompleteModal" [(ngModel)]="employeeId"
                (keyup.enter)="onEmloyeeChanged($event)" (keydown.esc)="resetFilter()">
              </app-iautocomplete>
            </div>
          </div>
          <div class="col-md-3">
            <label class="form-label">
              Client Name
            </label>
            <input class="form-control table-filter-control" (keyup.enter)="filterRecords()"
              (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.ClientName" placeholder="By Client Name">
          </div>
          <div class="col-md-3">
            <label class="form-label">
              Month
            </label>
            <select class="form-control table-filter-control" (keyup.enter)="filterRecords()"
              (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.Month">
              <option value="0" selected>Month</option>
              <option value="1">January</option>
              <option value="2">February</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
          </div>

          <div class="col-md-3">
            <label class="form-label">
              Billed Amount
            </label>
            <input class="form-control table-filter-control" (keyup.enter)="filterRecords()" readonly
              (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.BilledAmount" placeholder="By Billed Amount">
          </div>
        </div>

        <fieldset>
          <legend>Filter by billing detail.</legend>
          <p class="mark">Search bill by biling detail e.g. bill between numbers.</p>
          <div class="col-md-12 row">
            <div class="col-12 d-flex mb-3">
              <div class="ms-2 me-2">
                <input type="radio" name="bydate" value="0" (click)="selectBillOption($event)"> Filter between dates
              </div>
              <div class="ms-2 me-2">
                <input type="radio" name="bydate" value="1" (click)="selectBillOption($event)"> Before date
              </div>
              <div class="ms-2 me-2">
                <input type="radio" name="bydate" value="2" (click)="selectBillOption($event)"> After date
              </div>
            </div>

            <div class="col-md-12 row">
              <div class="col-md-3">
                <ng-container [ngSwitch]="RaisedBilloption">
                  <label class="form-label" *ngSwitchCase="0">From</label>
                  <label class="form-label" *ngSwitchCase="1">Before Date</label>
                  <label class="form-label" *ngSwitchCase="2">After Date</label>
                  <label class="form-label" *ngSwitchDefault>Date</label>
                </ng-container>
                <form class="form-inline">
                  <div class="form-group">
                    <div class="input-group">
                      <input class="form-control" placeholder="yyyy-mm-dd" (dateSelect)="fromDateSelection($event)"
                        name="from" [(ngModel)]="fromModel" ngbDatepicker #from="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-dark fa fa-calendar adv-srch-calenderbtn" (click)="from.toggle()"
                          type="button"></button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>

              <div class="col-md-3">
                <label for="" class="form-label">To</label>
                <form class="form-inline">
                  <div class="form-group">
                    <div class="input-group">
                      <input class="form-control" placeholder="yyyy-mm-dd" [readonly]="isReadonly"
                        (dateSelect)="toDateSelection($event)" name="to" [(ngModel)]="toModel" ngbDatepicker
                        #to="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-dark fa fa-calendar adv-srch-calenderbtn" (click)="to.toggle()"
                          [disabled]="isReadonly" type="button"></button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>

              <div class="col-md-3">
                <label class="form-label">
                  GST
                </label>
                <select class="form-control table-filter-control" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.GSTStatus">
                  <option value="0">Status</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="6">Raised</option>
                </select>
              </div>
            </div>

            <div class="col-md-12 row mt-4">
              <div class="col-md-3">
                <label class="form-label">
                  From Bill No.
                </label>
                <input class="form-control table-filter-control" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.FromBillNo" placeholder="By From Bill No">
              </div>
              <div class="col-md-3">
                <label class="form-label">
                  To Bill No.
                </label>
                <input class="form-control table-filter-control" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.ToBillNo" placeholder="By To Bill No">
              </div>

              <div class="col-md-3">
                <label class="form-label">
                  Take Home
                </label>
                <input class="form-control table-filter-control" (keyup.enter)="filterRecords()" readonly
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.TakeHome" placeholder="By Take Home">
              </div>

              <div class="col-md-3">
                <label class="form-label">
                  Bill Status
                </label>
                <select class="form-control table-filter-control" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.Status">
                  <option value="0">Status</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="7">Raised</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="modal-footer border-top-0  pe-5">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="resetFilter()">Close</button>
        <button type="button" [disabled]="isLoading" class="btn btn-primary-c" (click)="filterRecords()"><i
            class="pe-2 fa" [ngClass]="{'fa-spinner fa-pulse fa-fw': isLoading, 'fa-filter': !isLoading}"></i>
          {{ isLoading ? 'Wait' : 'Filter Record' }}</button>
      </div>
    </div>
  </div>
</div>

<!-- pdfviewing waiting model -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="pdfviewingModal" tabindex="-1"
  *ngIf="isPdfGenerating">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body f-12 text-center cog-wheel">
        <img src="assets/images/cog.gif" alt="">
        <h6 class="modal-title">Please Wait ........</h6>
      </div>
    </div>
  </div>
</div>

<!-- Download file model -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="downloadPopUp" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title">Download Bill</h5>
        <!-- <button type="button" class="close" (click)="closeWindow()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button> -->
      </div>
      <div class="modal-body f-12 text-center">
        <div class="d-flex align-items-center justify-content-around">
          <div class="form-check">
            <div class="donwload-file-ext">
              <img src="assets/ext/pdf.png" alt="">
            </div>
            <div class="d-flex align-items-center justify-content-center">
              <input class="form-check-input" type="radio" name="downloadFile" value="pdf" checked
                (change)="getFileExtension($event)">
              <label class="form-check-label ps-3" for="downloadPdf">
                Download Pdf
              </label>
            </div>
          </div>
          <div class="form-check">
            <div class="donwload-file-ext">
              <img src="assets/ext/doc.jpg" alt="">
            </div>
            <div class="d-flex align-items-center justify-content-center">
              <input class="form-check-input" type="radio" value="docx" name="downloadFile"
                (change)="getFileExtension($event)">
              <label class="form-check-label ps-3" for="downloadDoc">
                Download Doc
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-danger" (click)="closeWindow()">Close</button>
        <a href="{{downlodFilePath}}" class="d-none" id="downloadexistingfile"></a>
        <a class="btn btn-primary-c" [attr.disabled]="isLoading" (click)="downloadPdfDocx()" download>
          <i class="fa fa-download text-light pe-2"></i> Download
        </a>
      </div>
    </div>
  </div>
</div>
<!--view Pdf, Doc, Excel and send Email Modal -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="sendfileModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content px-4">
      <div class="modal-header border-bottom-0 d-flex">
        <h5 class="modal-title">Download Or Send Bill As EMail</h5>
        <div class="position-relative w-75 text-end" *ngIf="isBillGenerated">
          <input type="text" class="border-0 me-4 w-75 text-end"  [(ngModel)]="emailTemplate.EmailSubject" oninput="this.value = this.value.toUpperCase()"
                      placeholder="Enter your subject">
          <i class="edit fa fa-pencil position-absolute"></i>
        </div>
      </div>
      <div class="modal-body f-12 ">
        <div class="d-flex flex-column align-items-center" *ngIf="isBillGenerated">
          <div class="col-12">
            <div class="d-flex">
              <div class="col-md-4">
                <div class="d-flex align-items-center justify-content-around">
                  <div class="form-check">
                    <div class="donwload-file-ext text-center">
                      <img src="assets/ext/pdf.png" alt="pdf extension">
                    </div>
                    <div class="d-flex align-items-center justify-content-center">
                        <a href="javascript:void(0)" (click)="getFileExtension('pdf')" class="text-primary-c fw-b">
                          <i class="fa fa-download text-primary-c pe-2"></i>
                          PDF
                        </a>
                    </div>
                  </div>
                  <div class="form-check">
                    <div class="donwload-file-ext text-center">
                      <img src="assets/ext/doc.jpg" alt="word extension">
                    </div>
                    <div class="d-flex align-items-center justify-content-center">
                      <a href="javascript:void(0)" (click)="getFileExtension('docx')" class="text-primary-c fw-b">
                        <i class="fa fa-download text-primary-c pe-2"></i>
                        DOCX
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-8">
                <div class="row justify-content-end align-items-end">
                  <div class="col-md-4">
                    <select name="staffingTemplate" class="form-control" (change)="viewSendTemplete($event)">
                      <option value="">Select Template</option>
                      <option value="1" selected>Staffing Template</option>
                    </select>
                  </div>

                  <div class="col-md-8">
                    <div class="input-group">
                      <input type="email" class="form-control" placeholder="Email Id" name="add-email" aria-label="Email Id" aria-describedby="add-email">
                      <button class="btn btn-primary-c" type="button" (click)="addEmailId()" id="add-email">
                        <i class="fa fa-plus pe-2"></i>Add
                      </button>
                    </div>
                  </div>
                </div>
                <div class="py-3">
                  <p class="text-dark mb-2">Send To:</p>
                  <ng-container *ngFor="let email of emailTemplate.Emails; let i = index">
                    <span class="badge fs-6 fw-normal bg-ant text-dark me-2 my-2">
                      {{email}}
                      <a href="javascript:void(0)" (click)="removeEmail(i)" class="text-decoration-none">
                        <i class="fa fa-close ps-2 text-dark"></i>
                      </a>
                    </span>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-12 text-start">
            <ng-container *ngIf="emailTemplate !== null">
              <div class="mt-4">
                <div class="mb-1">
                  {{emailTemplate.Salutation | uppercase}}
                </div>
                <div class="mb-1">
                  <div class="position-relative">
                    <input type="text" class="border-0 w-75"  [(ngModel)]="emailTemplate.EmailTitle" oninput="this.value = this.value.toUpperCase()"
                      placeholder="Enter your title">
                    <i class="edit fa fa-pencil position-absolute"></i>
                  </div>
                </div>
                <div class="border py-3 px-2">

                  <div class="col-12">
                    <ng-container *ngIf="bodyContent != null">
                      <div class="no-focus-line" [innerHTML]="bodyContent" contenteditable>
                      </div>
                    </ng-container>
                  </div>

                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <div class="d-flex flex-row justify-context-end">
          <div class="me-3">
            <a href="javascript:void(0)" class="text-decoration-none text-muted"
            (click)="closePopUp()">Close</a>
          </div>
          <div>
            <a href="javascript:void(0)" class="text-primary-c fw-bold" (click)="sendEmail()">
              <i class="fa" [ngClass]="{'fa-spin fa-spinner': isLoading, 'fa-paper-plane': !isLoading}" aria-hidden="true"></i>
              <span class="ps-2">
                <ng-container *ngIf="isLoading">Sending...</ng-container>
                <ng-container *ngIf="!isLoading"><u>Send Email</u></ng-container>
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>