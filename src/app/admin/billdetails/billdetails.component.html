<div class="col-md-12 main-container">
  <ng-container *ngIf="isEmpPageReady">
    <!-- <div class="col-12 u-header curren-bg row m-0 mt-2">
      <div class="col-md-3">
        <div class="d-inline-block c-tab">
          <a class="a-tab tab-active">
            <span>Active</span>
          </a>
          <a class="a-tab">
            <span>InActive</span>
          </a>
          <a class="a-tab">
            <span>All</span>
          </a>
        </div>
      </div>
    </div> -->
    <div class="x_panel">
      <div class="x_header">
        <div class="x_header_title row">
          <div class="col-md-3">
            <h2>Employees<small>bill details</small></h2>
          </div>
        </div>
      </div>
      <div class="x_header">
        <div class="x_header_title mt-3">
          <div class="row">
            <div class="row">
              <div class="col-md-5 d-flex align-items-center" *ngIf="fileLoaded">
                <label class="form-label pe-3 mt-1">Developer *</label>
                <div style="width: 20rem">
                  <app-iautocomplete [data]="autoCompleteModal" [(ngModel)]="employeeId"
                    (OnSelect)="onEmloyeeChanged($event)" (keydown.esc)="resetFilter()">
                  </app-iautocomplete>
                </div>
              </div>
              <div class="col-md-7 row ms-2">
                <div class="col-md-12 row ms-4 p-0">
                  <div class="col-md-6 d-flex justify-content-end align-items-center">
                    <label for="" class="pe-2">Raised From</label>
                    <form class="form-inline">
                      <div class="form-group form-container">
                        <div class="input-group">
                          <input class="form-control form-control-sm" placeholder="yyyy-mm-dd"
                            (dateSelect)="fromDateSelection($event)" name="from" [(ngModel)]="fromModel" ngbDatepicker
                            #from="ngbDatepicker">
                          <div class="input-group-append">
                            <button class="btn btn-outline-dark fa fa-calendar btn-design" (click)="from.toggle()"
                              type="button"></button>
                          </div>
                        </div>
                      </div>
                    </form>

                    <!-- <input class="form-control table-filter-control" (keyup.enter)="filterRecords()" [(ngModel)]="employeeFile.GeneratedOn" placeholder="From Date"> -->
                  </div>
                  <div class="col-md-6 d-flex justify-content-end align-items-center">
                    <label for="" class="pe-2">Raised To</label>
                    <form class="form-inline">
                      <div class="form-group form-container">
                        <div class="input-group">
                          <input class="form-control form-control-sm" placeholder="yyyy-mm-dd"
                            (dateSelect)="toDateSelection($event)" name="to" [(ngModel)]="toModel" ngbDatepicker
                            #to="ngbDatepicker">
                          <div class="input-group-append">
                            <button class="btn btn-outline-dark fa fa-calendar btn-design" (click)="to.toggle()"
                              type="button"></button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Pdf viewer modal -->
      <div class="d-none file-container" id="file-container" (click)="closePdfViewer()">
        <div class="text-end">
          <a (click)="closePdfViewer()" class="close_view">
            <i class="fa fa-times fa-2x" aria-hidden="true"></i>
          </a>
        </div>
        <iframe src="" width="800px" height="600px" style="border: none;"></iframe>
      </div>

      <div class="x_content">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th width="6%">
                <input class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.BillNo" placeholder="By Bill No">
                <div class="col-title">
                  Bill No.#
                </div>
              </th>
              <th>
                <input class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.ClientName" placeholder="By Client Name">
                <div class="col-title">
                  Client Name
                </div>
              </th>
              <!-- <th>Month</th> -->
              <th width="8%">
                <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.Status">
                  <option value="0">Status</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="7">Raised</option>
                </select>
                <div class="col-title">
                  Status
                </div>
              </th>
              <th width="8%">
                <div class="col-title">
                  Paid On
                </div>
              </th>
              <th width="8%">
                <!-- <input class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                  [(ngModel)]="employeeFile.Month" placeholder="Month"> -->
                <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.Month">
                  <option value="0" selected>Status</option>
                  <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6">June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
                <div class="col-title">
                  Month
                </div>
              </th>
              <th width="14%">
                <input class="form-control table-filter-control form-control-sm" readonly
                  (keyup.enter)="filterRecords()" (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.BilledAmount"
                  placeholder="By Billed Amount">
                <div class="col-title">
                  Billed Amount
                </div>
              </th>
              <th width="10%">
                <input class="form-control table-filter-control form-control-sm" readonly
                  (keyup.enter)="filterRecords()" (keydown.esc)="resetFilter()"
                  [(ngModel)]="employeeFile.ReceivedAmount" placeholder="By Received Amount">
                <div class="col-title">
                  Received
                </div>
              </th>
              <th width="8%">
                <input class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.TakeHome" placeholder="By Received Amount">
                <div class="col-title">
                  Take Home
                </div>
              </th>
              <th width="7%">
                <select class="form-control table-filter-control form-control-sm" (keyup.enter)="filterRecords()"
                  (keydown.esc)="resetFilter()" [(ngModel)]="employeeFile.GSTStatus">
                  <option value="0">Status</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="6">Raised</option>
                </select>
                <div class="col-title">
                  GST
                </div>
              </th>
              <th class="text-center" width="7%">
                <div class="d-flex justify-content-around">
                  <a href="javascript:void(0)" class="text-dark ps-1" (click)="filterRecords()">
                    <i class="fa fa-filter zoom-2"></i>
                  </a>
                  <a href="javascript:void(0)" class="ms-2 text-danger ps-1" (click)="resetFilter()">
                    <i class="fa fa-refresh zoom-2"></i>
                  </a>
                </div>
                <div class="col-title text-center">
                  Action
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of billDetails">
              <td>
                <a href="javascript:void(0)" (click)="EditCurrentDocument(user)">{{user.BillNo}}</a>
              </td>
              <td>
                <div>
                  <a href="javascript:void(0)"
                    [ngClass]="{'blinking': user.Status == 'Raised', 'text-plain': user.Status != 'Raised'}"
                    (click)="EditClient(user.ClientId)">{{user.ClientName}}</a>
                  <div class="float-end">
                    <a><span class="badge bg-primary">T 21</span></a>
                    <span class="badge bg-danger ms-3">A {{user.Absent}}</span>
                  </div>
                </div>
                <small class="text-muted"><a href="javascript:void(0)" class="text-muted"
                    (click)="EditEmployee(user.FileOwnerId)">{{user.Name}}</a>
                </small>
              </td>
              <!-- <td>{{user.Month}}</td> -->
              <td>
                <a href="javascript:void(0)" class="h-font" (click)="UpdateCurrent(user.FileUid)">
                  {{user.Status}}
                </a>
              </td>
              <td>{{user.PaidOn}}</td>
              <td>{{user.Month}}</td>
              <td>
                <div>
                  <b>{{user.BilledAmount | number : '1.2-2'}}</b>
                  <div class="d-flex flex-column">
                    <small class="s-item text-muted me-2">[A] {{user.SalaryAmount | number : '1.2-2'}}</small>
                    <small class="s-item text-muted">[G] {{user.GSTAmount | number : '1.2-2'}}</small>
                  </div>
                </div>
              </td>
              <td>
                <b>{{user.ReceivedAmount | number : '1.2-2'}}</b>
                <div>
                  <small class="text-muted">[- 10% TDS]</small>
                </div>
              </td>
              <td>
                {{user.TakeHome | number : '1.2-2'}}
              </td>
              <td>
                <a href="javascript:void(0)" class="h-font" (click)="updateGSTStatus(user.BillNo, user.GSTAmount)">
                  {{user.GSTStatus}}
                </a>
              </td>
              <td>
                <div class="d-flex flex-row justify-content-around">
                  <!-- <a href="javascript:void(0)" (click)="AddEditDocuments(employee.Mobile)">
                    <span class="badge bg-dark">
                      <i class="fa fa-folder" aria-hidden="true"></i>
                    </span>
                  </a> -->
                  <a href="javascript:void(0)">
                    <span class="badge bg-success ms-1 me-1"><i class="fa fa-file-pdf-o" aria-hidden="true"
                        (click)="viewPdfFile(user)"></i></span>
                  </a>
                  <a href="javascript:void(0)">
                    <span class="badge bg-primary ms-1 me-1"><i class="fa fa-download" aria-hidden="true"
                        (click)="downloadFile(user)"></i></span>
                  </a>
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="6" class="fw-bold">
                Total Amount
              </td>
              <td>
                <div class="fw-bold">
                  Rs {{TotalBilledAmount | number : '1.2-2'}}
                  <div>
                    <small class="s-item text-muted me-2 d-block">[A] {{ TotalSalaryAmount | number : '1.2-2'}}</small>
                    <small class="s-item text-muted">[G] {{TotalGSTAmount | number : '1.2-2'}}</small>
                  </div>
                </div>
              </td>
              <td colspan="3" class="fw-bold">
                Rs {{TotalReceivedAmount | number : '1.2-2'}}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="mt-3">
        <app-pagination [pagination]="singleEmployee" (onPageChange)="GetFilterResult($event)"></app-pagination>
      </div>
    </div>
  </ng-container>
</div>


<!-- add update detail modal -->
<div class="modal fade" id="gstupdateModal" tabindex="-1" *ngIf="isGSTStatusModalReady">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Or Update</h5>
        <button type="button" class="close" (click)="closeWindow()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body f-12">
        <div class="col-md-12">
          <div [formGroup]="gstDetailForm" class="col-md-12 popup-form">
            <div class="col-md-12 row m-0">
              <div class="col-4 form-group">
                <label for="">Bill No.#</label>
                <input class="form-control disabled text-muted" disabled formControlName="Billno">
              </div>
              <div class="col-4 form-group">
                <label for="">GST Status</label>
                <select formControlName="Gststatus" name="Gststatus" class="form-control">
                  <option value="0">Status Type</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="4">Not Generated</option>
                  <option value="5">Rejected</option>
                  <option value="6">Generated</option>
                </select>
              </div>
              <div class="col-4 form-group">
                <label for="">Paid On</label>
                <form class="form-inline">
                  <div class="form-group w-100">
                    <div class="input-group w-100">
                      <input class="form-control" placeholder="yyyy-mm-dd" name="dp" [(ngModel)]="model"
                        (dateSelect)="onDateSelection($event)" ngbDatepicker #d="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button"><i
                            class="fa fa-calendar" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="col-md-12 row m-0 mt-4">
              <div class="col-4 form-group">
                <label for="">GST Amount</label>
                <input class="form-control disabled text-muted" disabled placeholder="GST Amount"
                  formControlName="Amount">
              </div>
              <div class="col-4 form-group">
                <label for="">Paid By</label>
                <select formControlName="Paidby" name="Paidby" class="form-control">
                  <option value="0">Employee Name</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="4">Not Generated</option>
                  <option value="5">Rejected</option>
                </select>
              </div>
            </div>
            <div class="col-md-12 row m-0">
              <div class="form-group mt-4">
                <input type="file" id="uploadocument" class="d-none" multiple (change)="GetDocumentFile($event)" />
                <a href="javascript:void(0)" class="text-muted d-inline-block mt-4 mb-2">
                  <i class="fa fa-upload zoom-2"></i>
                </a>
                <div class="file-upload-zone x_panel"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeWindow()">Close</button>

        <button class="btn btn-primary" [disabled]="isLoading" (click)="submitGSTStatusDetail()">
          <i class="fa" [ngClass]="{'fa-spin fa-spinner': isLoading, 'fa-check': !isLoading}"></i>
          {{ isLoading ? 'Processing' : 'Submit' }}
        </button>
      </div>
    </div>
  </div>
</div>


<!-- add update detail modal -->
<div class="modal fade" id="addupdateModal" tabindex="-1" *ngIf="isModalReady">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">GST Status Update Modal</h5>
        <button type="button" class="close" (click)="closeWindow()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body f-12">
        <div class="col-md-12">
          <div [formGroup]="documentForm" class="col-md-12 popup-form">
            <div class="col-md-12 row m-0">
              <div class="col-6 form-group">
                <label for="">File Status</label>
                <select formControlName="StatusId" name="StatusId" class="form-control">
                  <option value="0">File Status Type</option>
                  <option value="1">Completed</option>
                  <option value="2">Pending</option>
                  <option value="3">Canceled</option>
                  <option value="4">Not Generated</option>
                  <option value="5">Rejected</option>
                  <option value="7">Bill Raised</option>
                </select>
              </div>
              <div class="col-6 form-group">
                <label for="">Updated On</label>
                <form class="form-inline">
                  <div class="form-group w-100">
                    <div class="input-group w-100">
                      <input class="form-control " placeholder="yyyy-mm-dd" name="dp" [(ngModel)]="model"
                        (dateSelect)="onDateSelection($event)" ngbDatepicker #billd="ngbDatepicker">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary calendar" (click)="billd.toggle()" type="button"><i
                            class="fa fa-calendar" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="col-md-12 row m-0">
              <div class="form-group mt-4">
                <label for="">Notes</label>
                <textarea name="Notes" rows="3" formControlName="Notes" class="form-control"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeWindow()">Close</button>

        <button class="btn btn-primary" [disabled]="isLoading" (click)="updateRecord()">
          <i class="fa" [ngClass]="{'fa-spin fa-spinner': isLoading, 'fa-check': !isLoading}"></i>
          {{ isLoading ? 'Processing' : 'Submit' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- pdfviewing waiting model -->
<div class="modal fade" id="pdfviewingModal" tabindex="-1" *ngIf="isPdfGenerating">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body f-12 text-center cog-wheel">
        <img src="assets/images/cog.gif" alt="">
        <h6 class="modal-title">Please Wait ........</h6>
      </div>
    </div>
  </div>
</div>

<!-- Download file model -->
<div class="modal fade" id="downloadPopUp" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Download Bill</h5>
        <!-- <button type="button" class="close" (click)="closeWindow()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button> -->
      </div>
      <div class="modal-body f-12 text-center">
        <div class="d-flex align-items-center justify-content-around">
          <div class="form-check">
            <div class="donwload-file-ext">
              <img src="assets/ext/pdf.png" alt="">
            </div>
            <div class="d-flex align-items-center justify-content-center">
              <input class="form-check-input" type="radio" name="downloadFile" value="pdf" checked
                (change)="getFileExtension($event)">
              <label class="form-check-label ps-3" for="downloadPdf">
                Download Pdf
              </label>
            </div>
          </div>
          <div class="form-check">
            <div class="donwload-file-ext">
              <img src="assets/ext/doc.jpg" alt="">
            </div>
            <div class="d-flex align-items-center justify-content-center">
              <input class="form-check-input" type="radio" value="docx" name="downloadFile"
                (change)="getFileExtension($event)">
              <label class="form-check-label ps-3" for="downloadDoc">
                Download Doc
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="closeWindow()">Close</button>
        <a href="{{downlodFilePath}}" class="d-none" id="downloadexistingfile"></a>
        <a class="btn btn-primary" [attr.disabled]="isLoading" (click)="downloadPdfDocx()" download>
          <i class="fa fa-download text-light pe-2"></i> Download
        </a>
      </div>
    </div>
  </div>
</div>
